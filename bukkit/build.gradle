plugins {
    id "noqueuepluginmessage.java-bukkit-conventions"
    id "noqueuepluginmessage.java-plugin-conventions"
    id "java-library"
}

configurations {
    uber {
        canBeResolved = true
        canBeConsumed = true
    }
    api.extendsFrom(uber)
}

dependencies {
    uber project(":api")
}

tasks.named("jar", Jar) {
    archiveClassifier = "unshaded"
}

def uberTask = tasks.register("uberJar", Jar) {
    archiveClassifier = project.name

    from sourceSets.main.output

    dependsOn configurations.uber
    from {
        configurations.uber.findAll { it.name.endsWith("jar") }.collect { zipTree(it) }
    }
}

tasks.named("build") {
    finalizedBy uberTask
}
